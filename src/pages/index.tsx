import Head from 'next/head';
import { useUser } from '@clerk/nextjs';
import { SignInButton, SignOutButton } from '@clerk/nextjs';

import { api } from '@/utils/api';

import {
    Dialog,
    DialogClose,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
    DialogTrigger
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Spinner } from '@/components/ui/spinner';

import DidgYaListItem from '@/components/DidgYaListItem';
import { CreateDidgYaDialogForm } from '@/components/CreateDidgYaDialog';
import '@/modules/arrayExtensions';

export default function Home() {
    const user = useUser();
    let data = [];

    if (user.isLoaded) {
        const result = api.didgya.getAllByUserId.useQuery({
            userId: user?.user.id
        });
        data = result?.data || [];
    }

    function createDidgYa(userId: string) {
        if (!userId) return console.log('Please log in to create a DidgYa.');
        console.log(`Creating a new DidgYa as ${userId}...`);
    }

    return (
        <>
            <Head>
                <title>DidgYa</title>
                <meta name="description" content="Generated by create-t3-app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main className="flex min-h-screen flex-col items-center justify-center">
                <div className="container flex flex-col items-center justify-center gap-12 px-4 py-16 ">
                    <h1 className="text-5xl font-extrabold tracking-tight sm:text-[5rem]">
                        <span className="text-primary-light dark:text-primary-dark">
                            Didg
                        </span>
                        <span className="text-supporting-light dark:text-supporting-dark">
                            Ya
                        </span>
                    </h1>
                    <div className="max-w-lg text-center text-xl tracking-tight">
                        Did you do it? Did you experience it?
                        <span className="mx-1.5 font-bold">
                            <span className="text-primary-light dark:text-primary-dark">
                                Didg
                            </span>
                            <span className="text-supporting-light dark:text-supporting-dark">
                                Ya
                            </span>
                        </span>
                        is an app designed to simplify the way you track various
                        things that happen in your life.
                    </div>
                    <div className="">
                        {!user.isLoaded ? (
                            <Spinner
                                name="User"
                                className="text-primary-light dark:text-primary-dark"
                            />
                        ) : (
                            <span className="cursor-pointer rounded-lg bg-primary-light px-4 py-2 text-2xl font-bold text-text-dark shadow-2xl hover:bg-primary-light/60 dark:bg-primary-dark dark:text-text-dark hover:dark:bg-primary-dark/60">
                                {!user.isSignedIn && <SignInButton />}
                                {!!user.isSignedIn && <SignOutButton />}
                            </span>
                        )}
                    </div>
                    <div className="flex h-fit w-full flex-col items-center justify-start gap-1">
                        <CreateDidgYaDialogForm />
                        {/* {data?.map((didgya) => (
                            <DidgYaListItem key={didgya.id} {...didgya} />
                        ))} */}
                        {!user.isLoaded ? (
                            <Spinner name="DidgYas" />
                        ) : (
                            data?.map((didgya) => (
                                <DidgYaListItem key={didgya.id} {...didgya} />
                            ))
                        )}
                    </div>
                </div>
            </main>
        </>
    );
}
